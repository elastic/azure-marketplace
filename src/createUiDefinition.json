{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Compute.MultiVm",
  "version": "0.1.2-preview",
  "parameters": {
    "basics": [
      {
        "name": "adminUsername",
        "type": "Microsoft.Compute.UserNameTextBox",
        "label": "User name",
        "defaultValue": "",
        "toolTip": "Specify a user for accessing the virtual machines within your cluster. Must be a valid Ubuntu username",
        "constraints": {
          "required": true,
          "regex": "^(?!(?:adm|admin|audio|backup|bin|cdrom|crontab|daemon|dialout|dip|disk|fax|floppy|fuse|games|gnats|irc|kmem|landscape|libuuid|list|lp|mail|man|messagebus|mlocate|netdev|news|nobody|nogroup|operator|plugdev|proxy|root|sasl|shadow|src|ssh|sshd|staff|sudo|sync|sys|syslog|tape|tty|users|utmp|uucp|video|voice|whoopsie|www\\-data)$)\\w+$",
          "validationMessage": "Username must not be a reserved Ubuntu username"
        },
        "osPlatform": "Linux"
      },
      {
        "name": "password",
        "type": "Microsoft.Compute.CredentialsCombo",
        "label": {
          "authenticationType": "Authentication type",
          "password": "Password",
          "confirmPassword": "Confirm password",
          "sshPublicKey": "SSH public key"
        },
        "toolTip": {
          "authenticationType": "Choose Authentication type Password or PublicKey(SSH).",
          "password": "Enter the password for the specified user name.",
          "sshPublicKey": "Copy Public key into field."
        },
        "constraints": {
          "required": true
        },
        "options": {
          "hideConfirmation": false
        },
        "osPlatform": "Linux"
      }
    ],
    "steps": [
      {
        "name": "clusterSettingsStep",
        "label": "Cluster Settings",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "bladeTitle": "Cluster Settings",
        "elements": [
          {
            "name": "esVersion",
            "type": "Microsoft.Common.DropDown",
            "label": "Elasticsearch version",
            "defaultValue": "v6.3.1",
            "toolTip": "Choose a version of Elasticsearch.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "v5.3.2",
                  "value": "5.3.2"
                },
                {
                  "label": "v5.4.0",
                  "value": "5.4.0"
                },
                {
                  "label": "v5.4.2",
                  "value": "5.4.2"
                },
                {
                  "label": "v5.4.3",
                  "value": "5.4.3"
                },
                {
                  "label": "v5.5.0",
                  "value": "5.5.0"
                },
                {
                  "label": "v5.5.1",
                  "value": "5.5.1"
                },
                {
                  "label": "v5.5.2",
                  "value": "5.5.2"
                },
                {
                  "label": "v5.5.3",
                  "value": "5.5.3"
                },
                {
                  "label": "v5.6.3",
                  "value": "5.6.3"
                },
                {
                  "label": "v5.6.5",
                  "value": "5.6.5"
                },
                {
                  "label": "v5.6.6",
                  "value": "5.6.6"
                },
                {
                  "label": "v5.6.7",
                  "value": "5.6.7"
                },
                {
                  "label": "v5.6.8",
                  "value": "5.6.8"
                },
                {
                  "label": "v5.6.9",
                  "value": "5.6.9"
                },
                {
                  "label": "v5.6.10",
                  "value": "5.6.10"
                },
                {
                  "label": "v6.0.1",
                  "value": "6.0.1"
                },
                {
                  "label": "v6.1.3",
                  "value": "6.1.3"
                },
                {
                  "label": "v6.2.1",
                  "value": "6.2.1"
                },
                {
                  "label": "v6.2.2",
                  "value": "6.2.2"
                },
                {
                  "label": "v6.2.3",
                  "value": "6.2.3"
                },
                {
                  "label": "v6.2.4",
                  "value": "6.2.4"
                },
                {
                  "label": "v6.3.0",
                  "value": "6.3.0"
                },
                {
                  "label": "v6.3.1",
                  "value": "6.3.1"
                }
              ]
            }
          },
          {
            "name": "esClusterName",
            "type": "Microsoft.Common.TextBox",
            "label": "Cluster name",
            "defaultValue": "",
            "toolTip": "Name your Elasticsearch cluster.",
            "constraints": {
              "required": true,
              "regex": "[^\\s]+$",
              "validationMessage": "Cluster has trailing whitespace"
            }
          },
          {
            "name": "virtualNetworkConfiguration",
            "type": "Microsoft.Common.Section",
            "label": "Virtual network configuration",
            "elements": [
              {
                "name": "virtualNetwork",
                "type": "Microsoft.Network.VirtualNetworkCombo",
                "label": {
                  "virtualNetwork": "Virtual network",
                  "subnets": "Subnets"
                },
                "toolTip": {
                  "virtualNetwork": "Create a new Virtual Network or use an existing one",
                  "subnets": "Choose the Subnet for Elasticsearch nodes. If choosing an existing Virtual Network, the Subnets to use will need to exist beforehand; Creating a new subnet in an existing Virtual Network is not supported"
                },
                "defaultValue": {
                  "name": "es-net",
                  "addressPrefixSize": "/24"
                },
                "constraints": {
                  "minAddressPrefixSize": "/24"
                },
                "options": {
                  "hideExisting": false
                },
                "subnets": {
                  "subnet1": {
                    "label": "Elasticsearch nodes subnet",
                    "defaultValue": {
                      "name": "es-subnet",
                      "addressPrefixSize": "/25"
                    },
                    "constraints": {
                      "minAddressPrefixSize": "/25",
                      "minAddressCount": 3,
                      "requireContiguousAddresses": true
                    }
                  }
                }
              }
            ]
          }
        ]
      },
      {
        "name": "nodesStep",
        "label": "Nodes Configuration",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "bladeTitle": "Nodes Configuration",
        "elements": [
          {
            "name": "vmHostNamePrefix",
            "type": "Microsoft.Common.TextBox",
            "label": "Hostname prefix",
            "defaultValue": "",
            "toolTip": "The prefix to use for hostnames when naming virtual machines in the cluster. Hostnames are used for resolution of master nodes so if you are deploying a cluster into an existing virtual network containing an existing Elasticsearch cluster, be sure to set this to a unique prefix, to differentiate the hostnames of this cluster from an existing cluster",
            "constraints": {
              "required": false,
              "regex": "^[0-9a-zA-Z][0-9a-zA-Z\\-]{0,4}$",
              "validationMessage": "Host name prefix must start with an alphanumeric character and can contain alphanumeric or hyphen characters, up to 5 characters in length"
            }
          },
          {
            "name": "dataNodes",
            "type": "Microsoft.Common.Section",
            "label": "Data nodes",
            "elements": [
              {
                "name": "vmDataNodeCount",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of data nodes",
                "defaultValue": "3",
                "toolTip": "Specify the number of data nodes for this cluster. When not using dedicated master nodes, it is strongly recommended to have a minimum 3 data nodes in order to avoid split brain scenarios.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "1",
                      "value": 1
                    },
                    {
                      "label": "2",
                      "value": 2
                    },
                    {
                      "label": "3",
                      "value": 3
                    },
                    {
                      "label": "4",
                      "value": 4
                    },
                    {
                      "label": "5",
                      "value": 5
                    },
                    {
                      "label": "6",
                      "value": 6
                    },
                    {
                      "label": "7",
                      "value": 7
                    },
                    {
                      "label": "8",
                      "value": 8
                    },
                    {
                      "label": "9",
                      "value": 9
                    },
                    {
                      "label": "10",
                      "value": 10
                    },
                    {
                      "label": "11",
                      "value": 11
                    },
                    {
                      "label": "12",
                      "value": 12
                    },
                    {
                      "label": "15",
                      "value": 15
                    },
                    {
                      "label": "20",
                      "value": 20
                    },
                    {
                      "label": "25",
                      "value": 25
                    },
                    {
                      "label": "30",
                      "value": 30
                    },
                    {
                      "label": "35",
                      "value": 35
                    },
                    {
                      "label": "40",
                      "value": 40
                    },
                    {
                      "label": "45",
                      "value": 45
                    },
                    {
                      "label": "50",
                      "value": 50
                    }
                  ]
                }
              },
              {
                "name": "vmSizeDataNodes",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Data node VM size",
                "toolTip": "Choose VM SKU size for data nodes",
                "recommendedSizes": [
                  "Standard_DS1_v2",
                  "Standard_DS2_v2",
                  "Standard_DS3_v2",
                  "Standard_DS11_v2",
                  "Standard_DS12_v2"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_A0",
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_A5",
                    "Standard_A6",
                    "Standard_A7",
                    "Standard_A8",
                    "Standard_A9",
                    "Standard_A10",
                    "Standard_A11",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4",
                    "Standard_D11",
                    "Standard_D12",
                    "Standard_D13",
                    "Standard_D14",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2",
                    "Standard_D11_v2",
                    "Standard_D12_v2",
                    "Standard_D13_v2",
                    "Standard_D14_v2",
                    "Standard_D15_v2",
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_DS12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2",
                    "Standard_D2s_v3",
                    "Standard_D4s_v3",
                    "Standard_D8s_v3",
                    "Standard_D16s_v3",
                    "Standard_D32s_v3",
                    "Standard_D64s_v3",
                    "Standard_E2_v3",
                    "Standard_E4_v3",
                    "Standard_E8_v3",
                    "Standard_E16_v3",
                    "Standard_E32_v3",
                    "Standard_E64_v3",
                    "Standard_E64i_v3",
                    "Standard_E2s_v3",
                    "Standard_E4s_v3",
                    "Standard_E8s_v3",
                    "Standard_E16s_v3",
                    "Standard_E32s_v3",
                    "Standard_E64s_v3",
                    "Standard_E64is_v3",
                    "Standard_F1",
                    "Standard_F2",
                    "Standard_F4",
                    "Standard_F8",
                    "Standard_F16",
                    "Standard_F1s",
                    "Standard_F2s",
                    "Standard_F4s",
                    "Standard_F8s",
                    "Standard_F16s",
                    "Standard_G1",
                    "Standard_G2",
                    "Standard_G3",
                    "Standard_G4",
                    "Standard_G5",
                    "Standard_GS1",
                    "Standard_GS2",
                    "Standard_GS3",
                    "Standard_GS4",
                    "Standard_GS5",
                    "Standard_L4s",
                    "Standard_L8s",
                    "Standard_L16s",
                    "Standard_L32s",
                    "Standard_M8ms",
                    "Standard_M16ms",
                    "Standard_M32ts",
                    "Standard_M32ls",
                    "Standard_M32ms",
                    "Standard_M64s",
                    "Standard_M64ls",
                    "Standard_M64ms",
                    "Standard_M128s",
                    "Standard_M128ms",
                    "Standard_M64",
                    "Standard_M64m",
                    "Standard_M128",
                    "Standard_M128m"
                  ]
                },
                "osPlatform": "Linux",
                "count": "[steps('nodesStep').dataNodes.vmDataNodeCount]"
              },
              {
                "name": "dataNodesAreMasterEligible",
                "type": "Microsoft.Common.OptionsGroup",
                "label": "Data nodes are master eligible",
                "defaultValue": "No",
                "toolTip": "Allow data nodes to be master eligible, setting this to Yes will no longer deploy the 3 dedicated master nodes",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Yes",
                      "value": "Yes"
                    },
                    {
                      "label": "No",
                      "value": "No"
                    }
                  ]
                }
              }
            ]
          },
          {
            "name": "dataNodesDisks",
            "type": "Microsoft.Common.Section",
            "label": "Data node disks",
            "elements": [
              {
                "name": "vmDataDiskCount",
                "type": "Microsoft.Common.TextBox",
                "label": "Number of managed disks per data node",
                "defaultValue": "1",
                "toolTip": "Number of disks to attach to each data node in RAID 0 setup. If the number of disks selected is more than can be attached to the selected data node VM size, the maximum number of disks that can be attached will be used. If 1 disk is selected, it is not RAIDed. If 0 disks are selected, the temporary disk will be used to store Elasticsearch data. IMPORTANT: The temporary disk is ephemeral in nature so be sure you know the trade-offs when choosing 0 disks.",
                "constraints": {
                  "required": true,
                  "regex": "^\\d+$",
                  "validationMessage": "Value must be numeric and greater than or equal to 0"
                }
              },
              {
                "name": "vmDataDiskSize",
                "type": "Microsoft.Common.DropDown",
                "label": "Size of each managed disk",
                "visible": "[greater(steps('nodesStep').dataNodesDisks.vmDataDiskCount, 0)]",
                "defaultValue": "Large (1024Gb)",
                "toolTip": "The size of each data disk to attach to each data node",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Small (128Gb)",
                      "value": "Small"
                    },
                    {
                      "label": "Medium (512Gb)",
                      "value": "Medium"
                    },
                    {
                      "label": "Large (1024Gb)",
                      "value": "Large"
                    },
                    {
                      "label": "Extra Large (2048Gb)",
                      "value": "XLarge"
                    },
                    {
                      "label": "Extra Extra Large (4095Gb)",
                      "value": "XXLarge"
                    }
                  ]
                }
              },
              {
                "name": "storageAccountType",
                "type": "Microsoft.Common.DropDown",
                "label": "Type of managed disks",
                "visible": "[greater(steps('nodesStep').dataNodesDisks.vmDataDiskCount, 0)]",
                "defaultValue": "Default disks for Data node VM size",
                "toolTip": "The storage type of managed disks. The default will be Premium disks for VMs that support Premium disks and Standard disks for those that do not.",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "Standard disks",
                      "value": "Standard"
                    },
                    {
                      "label": "Default disks for Data node VM size",
                      "value": "Default"
                    }
                  ]
                }
              }
            ]
          },
          {
            "name": "masterNodes",
            "type": "Microsoft.Common.Section",
            "label": "Master nodes",
            "visible": "[equals(steps('nodesStep').dataNodes.dataNodesAreMasterEligible, 'No')]",
            "elements": [
              {
                "name": "vmSizeMasterNodes",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Master node VM size",
                "toolTip": "Choose VM SKU size for master nodes",
                "recommendedSizes": [
                  "Standard_D1",
                  "Standard_D2",
                  "Standard_D3"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_A0",
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_A5",
                    "Standard_A6",
                    "Standard_A7",
                    "Standard_A8",
                    "Standard_A9",
                    "Standard_A10",
                    "Standard_A11",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4",
                    "Standard_D11",
                    "Standard_D12",
                    "Standard_D13",
                    "Standard_D14",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2",
                    "Standard_D11_v2",
                    "Standard_D12_v2",
                    "Standard_D13_v2",
                    "Standard_D14_v2",
                    "Standard_D15_v2",
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_DS12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2",
                    "Standard_D2s_v3",
                    "Standard_D4s_v3",
                    "Standard_D8s_v3",
                    "Standard_D16s_v3",
                    "Standard_D32s_v3",
                    "Standard_D64s_v3",
                    "Standard_E2_v3",
                    "Standard_E4_v3",
                    "Standard_E8_v3",
                    "Standard_E16_v3",
                    "Standard_E32_v3",
                    "Standard_E64_v3",
                    "Standard_E64i_v3",
                    "Standard_E2s_v3",
                    "Standard_E4s_v3",
                    "Standard_E8s_v3",
                    "Standard_E16s_v3",
                    "Standard_E32s_v3",
                    "Standard_E64s_v3",
                    "Standard_E64is_v3",
                    "Standard_F1",
                    "Standard_F2",
                    "Standard_F4",
                    "Standard_F8",
                    "Standard_F16",
                    "Standard_F1s",
                    "Standard_F2s",
                    "Standard_F4s",
                    "Standard_F8s",
                    "Standard_F16s",
                    "Standard_G1",
                    "Standard_G2",
                    "Standard_G3",
                    "Standard_G4",
                    "Standard_G5",
                    "Standard_GS1",
                    "Standard_GS2",
                    "Standard_GS3",
                    "Standard_GS4",
                    "Standard_GS5",
                    "Standard_L4s",
                    "Standard_L8s",
                    "Standard_L16s",
                    "Standard_L32s",
                    "Standard_M8ms",
                    "Standard_M16ms",
                    "Standard_M32ts",
                    "Standard_M32ls",
                    "Standard_M32ms",
                    "Standard_M64s",
                    "Standard_M64ls",
                    "Standard_M64ms",
                    "Standard_M128s",
                    "Standard_M128ms",
                    "Standard_M64",
                    "Standard_M64m",
                    "Standard_M128",
                    "Standard_M128m"
                  ]
                },
                "osPlatform": "Linux",
                "count": "3"
              }
            ]
          },
          {
            "name": "clientNodes",
            "type": "Microsoft.Common.Section",
            "label": "Client nodes",
            "elements": [
              {
                "name": "vmClientNodeCount",
                "type": "Microsoft.Common.DropDown",
                "label": "Number of client nodes",
                "defaultValue": "0",
                "toolTip": "Specify the number of client nodes for this cluster (optional).",
                "constraints": {
                  "allowedValues": [
                    {
                      "label": "0",
                      "value": 0
                    },
                    {
                      "label": "1",
                      "value": 1
                    },
                    {
                      "label": "2",
                      "value": 2
                    },
                    {
                      "label": "3",
                      "value": 3
                    },
                    {
                      "label": "4",
                      "value": 4
                    },
                    {
                      "label": "5",
                      "value": 5
                    },
                    {
                      "label": "6",
                      "value": 6
                    },
                    {
                      "label": "7",
                      "value": 7
                    },
                    {
                      "label": "8",
                      "value": 8
                    },
                    {
                      "label": "9",
                      "value": 9
                    },
                    {
                      "label": "10",
                      "value": 10
                    },
                    {
                      "label": "11",
                      "value": 11
                    },
                    {
                      "label": "12",
                      "value": 12
                    },
                    {
                      "label": "15",
                      "value": 15
                    },
                    {
                      "label": "20",
                      "value": 20
                    }
                  ]
                }
              },
              {
                "name": "vmSizeClientNodes",
                "type": "Microsoft.Compute.SizeSelector",
                "label": "Client node VM size",
                "toolTip": "Choose VM SKU size for client (coordinating) nodes",
                "visible": "[greater(steps('nodesStep').clientNodes.vmClientNodeCount, 0)]",
                "recommendedSizes": [
                  "Standard_D1",
                  "Standard_D2",
                  "Standard_D3"
                ],
                "constraints": {
                  "allowedSizes": [
                    "Standard_A0",
                    "Standard_A1",
                    "Standard_A2",
                    "Standard_A3",
                    "Standard_A4",
                    "Standard_A5",
                    "Standard_A6",
                    "Standard_A7",
                    "Standard_A8",
                    "Standard_A9",
                    "Standard_A10",
                    "Standard_A11",
                    "Standard_D1",
                    "Standard_D2",
                    "Standard_D3",
                    "Standard_D4",
                    "Standard_D11",
                    "Standard_D12",
                    "Standard_D13",
                    "Standard_D14",
                    "Standard_D1_v2",
                    "Standard_D2_v2",
                    "Standard_D3_v2",
                    "Standard_D4_v2",
                    "Standard_D5_v2",
                    "Standard_D11_v2",
                    "Standard_D12_v2",
                    "Standard_D13_v2",
                    "Standard_D14_v2",
                    "Standard_D15_v2",
                    "Standard_DS1",
                    "Standard_DS2",
                    "Standard_DS3",
                    "Standard_DS4",
                    "Standard_DS11",
                    "Standard_DS12",
                    "Standard_DS13",
                    "Standard_DS14",
                    "Standard_DS1_v2",
                    "Standard_DS2_v2",
                    "Standard_DS3_v2",
                    "Standard_DS4_v2",
                    "Standard_DS5_v2",
                    "Standard_DS11_v2",
                    "Standard_DS12_v2",
                    "Standard_DS13_v2",
                    "Standard_DS14_v2",
                    "Standard_DS15_v2",
                    "Standard_D2s_v3",
                    "Standard_D4s_v3",
                    "Standard_D8s_v3",
                    "Standard_D16s_v3",
                    "Standard_D32s_v3",
                    "Standard_D64s_v3",
                    "Standard_E2_v3",
                    "Standard_E4_v3",
                    "Standard_E8_v3",
                    "Standard_E16_v3",
                    "Standard_E32_v3",
                    "Standard_E64_v3",
                    "Standard_E64i_v3",
                    "Standard_E2s_v3",
                    "Standard_E4s_v3",
                    "Standard_E8s_v3",
                    "Standard_E16s_v3",
                    "Standard_E32s_v3",
                    "Standard_E64s_v3",
                    "Standard_E64is_v3",
                    "Standard_F1",
                    "Standard_F2",
                    "Standard_F4",
                    "Standard_F8",
                    "Standard_F16",
                    "Standard_F1s",
                    "Standard_F2s",
                    "Standard_F4s",
                    "Standard_F8s",
                    "Standard_F16s",
                    "Standard_G1",
                    "Standard_G2",
                    "Standard_G3",
                    "Standard_G4",
                    "Standard_G5",
                    "Standard_GS1",
                    "Standard_GS2",
                    "Standard_GS3",
                    "Standard_GS4",
                    "Standard_GS5",
                    "Standard_L4s",
                    "Standard_L8s",
                    "Standard_L16s",
                    "Standard_L32s",
                    "Standard_M8ms",
                    "Standard_M16ms",
                    "Standard_M32ts",
                    "Standard_M32ls",
                    "Standard_M32ms",
                    "Standard_M64s",
                    "Standard_M64ls",
                    "Standard_M64ms",
                    "Standard_M128s",
                    "Standard_M128ms",
                    "Standard_M64",
                    "Standard_M64m",
                    "Standard_M128",
                    "Standard_M128m"
                  ]
                },
                "osPlatform": "Linux",
                "count": "[steps('nodesStep').clientNodes.vmClientNodeCount]"
              }
            ]
          }
        ]
      },
      {
        "name": "securityStep",
        "label": "User Configuration",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "bladeTitle": "User Configuration",
        "elements": [
          {
            "name": "es_admin",
            "type": "Microsoft.Common.Section",
            "label": "Elastic user account",
            "elements": [
              {
                "name": "securityAdminPassword",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "'elastic' built-in user password",
                  "confirmPassword": "Confirm password"
                },
                "toolTip": "Password for the built-in 'elastic' user. This is a built-in superuser account with unlimited access",
                "constraints": {
                  "required": true,
                  "regex": "^.{6,}",
                  "validationMessage": "Password must be at least 6 characters long"
                },
                "options": {
                  "hideConfirmation": false
                }
              }
            ]
          },
          {
            "name": "es_kibana",
            "type": "Microsoft.Common.Section",
            "label": "Kibana user account",
            "elements": [
              {
                "name": "securityKibanaPassword",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "'kibana' built-in user password",
                  "confirmPassword": "Confirm password"
                },
                "toolTip": "Password for the built-in 'kibana' user. This is a built-in account that Kibana uses to communicate with Elasticsearch",
                "constraints": {
                  "required": true,
                  "regex": "^.{6,}",
                  "validationMessage": "Password must be at least 6 characters long"
                },
                "options": {
                  "hideConfirmation": false
                }
              }
            ]
          },
          {
            "name": "es_logstash",
            "type": "Microsoft.Common.Section",
            "label": "Logstash system user account",
            "elements": [
              {
                "name": "securityLogstashPassword",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "'logstash_system' built-in user password",
                  "confirmPassword": "Confirm password"
                },
                "toolTip": "Password for the built-in 'logstash_system' user. This is a built-in account that Logstash uses to communicate with Elasticsearch.",
                "constraints": {
                  "required": true,
                  "regex": "^.{6,}",
                  "validationMessage": "Password must be at least 6 characters long"
                },
                "options": {
                  "hideConfirmation": false
                }
              }
            ]
          },
          {
            "name": "es_read",
            "type": "Microsoft.Common.Section",
            "label": "es_read (read only) user account",
            "elements": [
              {
                "name": "securityReadPassword",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "'es_read' user password",
                  "confirmPassword": "Confirm password"
                },
                "toolTip": "Password to use for the 'es_read' user. This is a user account configured with limited read-only access",
                "constraints": {
                  "required": true,
                  "regex": "^.{6,}",
                  "validationMessage": "Password must be at least 6 characters long"
                },
                "options": {
                  "hideConfirmation": false
                }
              }
            ]
          }
        ]
      },
      {
        "name": "externalAccessStep",
        "label": "External Access",
        "subLabel": {
          "preValidation": "Required",
          "postValidation": "Done"
        },
        "bladeTitle": "External Access Control",
        "elements": [
          {
            "name": "kibana",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Install Kibana?",
            "defaultValue": "Yes",
            "toolTip": "Yes, to provision a single Kibana instance.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": "Yes"
                },
                {
                  "label": "No",
                  "value": "No"
                }
              ]
            }
          },
          {
            "name": "vmSizeKibana",
            "type": "Microsoft.Compute.SizeSelector",
            "label": "Kibana VM size",
            "toolTip": "Choose VM SKU, Standard D1, D2, D3",
            "visible": "[equals(steps('externalAccessStep').kibana, 'Yes')]",
            "recommendedSizes": [
              "Standard_D1",
              "Standard_D2",
              "Standard_D3"
            ],
            "constraints": {
              "allowedSizes": [
                "Standard_A2",
                "Standard_A3",
                "Standard_A4",
                "Standard_A5",
                "Standard_A6",
                "Standard_A7",
                "Standard_A8",
                "Standard_A9",
                "Standard_A10",
                "Standard_A11",
                "Standard_D1",
                "Standard_D2",
                "Standard_D3",
                "Standard_D4",
                "Standard_D11",
                "Standard_D12",
                "Standard_D13",
                "Standard_D14",
                "Standard_D1_v2",
                "Standard_D2_v2",
                "Standard_D3_v2",
                "Standard_D4_v2",
                "Standard_D5_v2",
                "Standard_D11_v2",
                "Standard_D12_v2",
                "Standard_D13_v2",
                "Standard_D14_v2",
                "Standard_D15_v2",
                "Standard_DS1",
                "Standard_DS2",
                "Standard_DS3",
                "Standard_DS4",
                "Standard_DS11",
                "Standard_DS12",
                "Standard_DS13",
                "Standard_DS14",
                "Standard_DS1_v2",
                "Standard_DS2_v2",
                "Standard_DS3_v2",
                "Standard_DS4_v2",
                "Standard_DS5_v2",
                "Standard_DS11_v2",
                "Standard_DS12_v2",
                "Standard_DS13_v2",
                "Standard_DS14_v2",
                "Standard_DS15_v2",
                "Standard_D2s_v3",
                "Standard_D4s_v3",
                "Standard_D8s_v3",
                "Standard_D16s_v3",
                "Standard_D32s_v3",
                "Standard_D64s_v3",
                "Standard_E2_v3",
                "Standard_E4_v3",
                "Standard_E8_v3",
                "Standard_E16_v3",
                "Standard_E32_v3",
                "Standard_E64_v3",
                "Standard_E64i_v3",
                "Standard_E2s_v3",
                "Standard_E4s_v3",
                "Standard_E8s_v3",
                "Standard_E16s_v3",
                "Standard_E32s_v3",
                "Standard_E64s_v3",
                "Standard_E64is_v3",
                "Standard_F1",
                "Standard_F2",
                "Standard_F4",
                "Standard_F8",
                "Standard_F16",
                "Standard_F1s",
                "Standard_F2s",
                "Standard_F4s",
                "Standard_F8s",
                "Standard_F16s",
                "Standard_G1",
                "Standard_G2",
                "Standard_G3",
                "Standard_G4",
                "Standard_G5",
                "Standard_GS1",
                "Standard_GS2",
                "Standard_GS3",
                "Standard_GS4",
                "Standard_GS5",
                "Standard_L4s",
                "Standard_L8s",
                "Standard_L16s",
                "Standard_L32s",
                "Standard_M8ms",
                "Standard_M16ms",
                "Standard_M32ts",
                "Standard_M32ls",
                "Standard_M32ms",
                "Standard_M64s",
                "Standard_M64ls",
                "Standard_M64ms",
                "Standard_M128s",
                "Standard_M128ms",
                "Standard_M64",
                "Standard_M64m",
                "Standard_M128",
                "Standard_M128m"
              ]
            },
            "osPlatform": "Linux",
            "count": "1"
          },
          {
            "name": "jumpbox",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Use a jump box?",
            "defaultValue": "No",
            "toolTip": "A jump box allows you to connect to your cluster from a public access point like SSH. This is usually not necessary if Kibana is installed, since Kibana itself acts as a jump box.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Yes",
                  "value": "Yes"
                },
                {
                  "label": "No",
                  "value": "No"
                }
              ]
            }
          },
          {
            "name": "loadBalancerType",
            "type": "Microsoft.Common.OptionsGroup",
            "label": "Load balancer type",
            "defaultValue": "Internal",
            "toolTip": "Choose whether the load balancer should be public facing (external) or internal.",
            "constraints": {
              "allowedValues": [
                {
                  "label": "Internal",
                  "value": "internal"
                },
                {
                  "label": "External",
                  "value": "external"
                }
              ]
            }
          }
        ]
      }
    ],
    "outputs": {
      "esVersion": "[steps('clusterSettingsStep').esVersion]",
      "esClusterName": "[steps('clusterSettingsStep').esClusterName]",
      "azureCloudPlugin": "No",
      "azureCloudStorageAccountName": "",
      "azureCloudStorageAccountKey": "",
      "xpackPlugins": "Yes",
      "esAdditionalPlugins": "",
      "esAdditionalYaml": "",
      "esHttpCertBlob": "",
      "esHttpCertPassword": "",
      "esHttpCaCertBlob": "",
      "esHttpCaCertPassword": "",
      "esTransportCaCertBlob": "",
      "esTransportCaCertPassword": "",
      "esTransportCertPassword": "",
      "samlMetadataUri": "",
      "samlServiceProviderUri": "",
      "esHeapSize": 0,
      "loadBalancerType": "[steps('externalAccessStep').loadBalancerType]",
      "vNetNewOrExisting": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.newOrExisting]",
      "vNetName": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.name]",
      "vNetClusterSubnetName": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.subnets.subnet1.name]",
      "vNetLoadBalancerIp": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.subnets.subnet1.startAddress]",
      "vNetExistingResourceGroup": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.resourceGroup]",
      "vNetNewAddressPrefix": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.addressPrefix]",
      "vNetNewClusterSubnetAddressPrefix": "[steps('clusterSettingsStep').virtualNetworkConfiguration.virtualNetwork.subnets.subnet1.addressPrefix]",
      "vNetAppGatewaySubnetName": "es-gateway-subnet",
      "vNetNewAppGatewaySubnetAddressPrefix": "10.0.0.128/28",
      "kibana": "[steps('externalAccessStep').kibana]",
      "vmSizeKibana": "[steps('externalAccessStep').vmSizeKibana]",
      "kibanaKeyBlob": "",
      "kibanaCertBlob": "",
      "kibanaKeyPassphrase": "",
      "kibanaAdditionalYaml": "",
      "jumpbox": "[steps('externalAccessStep').jumpbox]",
      "vmSizeDataNodes": "[steps('nodesStep').dataNodes.vmSizeDataNodes]",
      "vmDataDiskCount": "[steps('nodesStep').dataNodesDisks.vmDataDiskCount]",
      "vmDataDiskSize": "[steps('nodesStep').dataNodesDisks.vmDataDiskSize]",
      "vmDataNodeCount": "[steps('nodesStep').dataNodes.vmDataNodeCount]",
      "storageAccountType": "[steps('nodesStep').dataNodesDisks.storageAccountType]",
      "dataNodesAreMasterEligible": "[steps('nodesStep').dataNodes.dataNodesAreMasterEligible]",
      "vmHostNamePrefix": "[steps('nodesStep').vmHostNamePrefix]",
      "vmSizeMasterNodes": "[steps('nodesStep').masterNodes.vmSizeMasterNodes]",
      "vmClientNodeCount": "[steps('nodesStep').clientNodes.vmClientNodeCount]",
      "vmSizeClientNodes": "[steps('nodesStep').clientNodes.vmSizeClientNodes]",
      "adminUsername": "[basics('adminUsername')]",
      "authenticationType": "[basics('password').authenticationType]",
      "adminPassword": "[basics('password').password]",
      "sshPublicKey": "[basics('password').sshPublicKey]",
      "securityBootstrapPassword": "",
      "securityAdminPassword": "[steps('securityStep').es_admin.securityAdminPassword]",
      "securityReadPassword": "[steps('securityStep').es_read.securityReadPassword]",
      "securityKibanaPassword": "[steps('securityStep').es_kibana.securityKibanaPassword]",
      "securityLogstashPassword": "[steps('securityStep').es_logstash.securityLogstashPassword]",
      "appGatewayTier": "Standard",
      "appGatewaySku": "Small",
      "appGatewayCount": 1,
      "appGatewayCertBlob": "",
      "appGatewayCertPassword": "",
      "appGatewayEsHttpCertBlob": "",
      "appGatewayWafStatus": "Disabled",
      "appGatewayWafMode": "Detection",
      "location": "[location()]"
    }
  }
}
